<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Administrador - Dashboard</title>
<link rel="icon" type="image/svg+xml" href="https://upload.wikimedia.org/wikipedia/commons/a/ad/Coat_of_arms_of_the_Brazilian_Navy.svg">

<style>
:root {
  --cor-primaria: #004aad;
  --cor-primaria-hover: #003b8e;
  --cor-fundo: #f5f7fa;
  --cor-texto: #1f2937;
  --cor-card: #ffffff;
  --cor-borda: #d1d5db;
  --cor-secundaria: #e2e8f0;
  --cor-sucesso: #16a34a;
  --cor-erro: #dc2626;
  --cor-aviso: #f59e0b;
  --cor-info: #2563eb;
  --sombra: rgba(0, 0, 0, 0.1);
}

@media (prefers-color-scheme: dark) {
  :root {
    --cor-fundo: #0b1120;
    --cor-card: #111827;
    --cor-texto: #e5e7eb;
    --cor-borda: #1f2937;
    --cor-secundaria: #1e293b;
    --sombra: rgba(255, 255, 255, 0.05);
  }
}

* {
  box-sizing: border-box;
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  margin: 0;
  padding: 0;
}

body {
  background: var(--cor-fundo);
  color: var(--cor-texto);
  min-height: 100vh;
  padding: 30px 10px;
}

/* ===== CONTAINER ===== */
.container {
  max-width: 1250px;
  margin: auto;
  background: var(--cor-card);
  border-radius: 10px;
  box-shadow: 0 4px 18px var(--sombra);
  padding: 24px;
  transition: 0.3s;
}

.container:hover {
  box-shadow: 0 6px 24px var(--sombra);
}

/* ===== CABE√áALHO ===== */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
  gap: 10px;
}

.logo-marinha {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-marinha img {
  width: 52px;
  height: 52px;
}

header h1 {
  color: var(--cor-primaria);
  font-size: 1.4rem;
  margin: 0;
  font-weight: 700;
}

header button {
  background: var(--cor-erro);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.25s;
}

header button:hover {
  background: #b91c1c;
}

/* ===== TABS ===== */
.nav-tabs {
  display: flex;
  gap: 8px;
  margin: 12px 0 18px;
  flex-wrap: wrap;
}

.nav-tabs button {
  background: var(--cor-secundaria);
  border: 1px solid var(--cor-borda);
  color: var(--cor-texto);
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s;
}

.nav-tabs button:hover {
  filter: brightness(0.95);
}

.nav-tabs button.active {
  background: var(--cor-primaria);
  color: #fff;
  border-color: var(--cor-primaria);
}

/* ===== T√çTULOS ===== */
h2 {
  color: var(--cor-primaria);
  margin: 0 0 8px;
  border-left: 4px solid var(--cor-primaria);
  padding-left: 10px;
  font-weight: 700;
}

/* ===== TABELAS ===== */
.table-wrap {
  overflow: auto;
  border: 1px solid var(--cor-borda);
  border-radius: 10px;
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 980px;
}

thead {
  background: var(--cor-primaria);
  color: #fff;
}

th, td {
  padding: 10px 12px;
  border-bottom: 1px solid var(--cor-borda);
  text-align: left;
  vertical-align: middle;
}

tbody tr:hover {
  background: rgba(0, 74, 173, 0.05);
  transition: background 0.2s;
}

/* ===== BOT√ïES DE A√á√ÉO ===== */
.actions {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

button.aprovar {
  background: var(--cor-sucesso);
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  transition: 0.2s;
}
button.aprovar:hover { background: #15803d; }

button.desaprovar {
  background: var(--cor-info);
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  transition: 0.2s;
}
button.desaprovar:hover { background: #1d4ed8; }

button.editar {
  background: var(--cor-aviso);
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  transition: 0.2s;
}
button.editar:hover { background: #b45309; }

button.reset {
  background: var(--cor-secundaria);
  color: var(--cor-texto);
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  transition: 0.2s;
}
button.reset:hover { filter: brightness(0.9); }

button.excluir {
  background: var(--cor-erro);
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  transition: 0.2s;
}
button.excluir:hover { background: #b91c1c; }

/* ===== BADGES ===== */
.badge-ok {
  display: inline-block;
  background: rgba(22, 163, 74, 0.12);
  color: #166534;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: 700;
}

.badge-no {
  display: inline-block;
  background: rgba(220, 38, 38, 0.12);
  color: #991b1b;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: 700;
}

.badge-warn {
  display: inline-block;
  background: rgba(245, 158, 11, 0.12);
  color: #92400e;
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: 700;
}

.tag-fp {
  color: var(--cor-erro);
  font-weight: 700;
}

/* ===== FILTROS ===== */
.filters {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin: 8px 0 12px;
}

.filters input,
.filters select {
  padding: 8px 10px;
  border: 1px solid var(--cor-borda);
  border-radius: 8px;
  background: #fff;
  font-size: 14px;
  transition: 0.2s;
}

.filters input:focus,
.filters select:focus {
  outline: none;
  border-color: var(--cor-primaria);
  box-shadow: 0 0 0 2px rgba(0, 74, 173, 0.2);
}

/* ===== RESPONSIVIDADE ===== */
@media (max-width: 900px) {
  header {
    flex-direction: column;
    align-items: flex-start;
  }

  .logo-marinha {
    flex-direction: row;
  }

  table {
    min-width: 720px;
  }

  h2 {
    font-size: 1.1rem;
  }
}

@media (max-width: 600px) {
  body {
    padding: 20px 8px;
  }

  .container {
    padding: 18px;
  }

  .nav-tabs {
    flex-wrap: wrap;
    justify-content: center;
  }

  .nav-tabs button {
    flex: 1 1 auto;
    font-size: 0.9rem;
  }

  header h1 {
    font-size: 1rem;
    text-align: center;
  }

  table {
    min-width: 600px;
  }

  .actions button {
    flex: 1 1 45%;
  }
}
</style>
</head>

<body>
  <div class="container">
    <header>
      <div class="logo-marinha">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/ad/Coat_of_arms_of_the_Brazilian_Navy.svg" alt="Marinha do Brasil">
        <h1>Administrador ‚Äî Sistema de Viaturas</h1>
      </div>
      <button onclick="logout()">Sair</button>
    </header>

    <div class="nav-tabs">
      <button class="active" data-tab="tab-usuarios" onclick="setTab('tab-usuarios', this)">Usu√°rios</button>
      <button data-tab="tab-missoes" onclick="setTab('tab-missoes', this)">Miss√µes</button>
      <button data-tab="tab-logs" onclick="setTab('tab-logs', this)">Logs do Sistema</button>
      <button data-tab="tab-emulacao" onclick="setTab('tab-emulacao', this)">Emula√ß√£o</button>
    </div>

    <!-- Usu√°rios -->
    <section id="tab-usuarios" class="tab-pane" style="display:block;">
      <h2>Gerenciamento de Usu√°rios</h2>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Nome</th><th>Email</th><th>Cargo</th><th>Status</th><th style="min-width:420px">A√ß√µes</th></tr>
          </thead>
          <tbody id="usuarios-body"></tbody>
        </table>
      </div>
    </section>

    <!-- Outras abas omitidas (iguais √†s anteriores, n√£o modificadas) -->
  </div>

<script type="module">
import { auth, db } from "./firebase-config.js";
import { signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import {
  collection, onSnapshot, doc, updateDoc, deleteDoc, getDoc, addDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

/* Sess√£o e logout */
const LIMITE = 10*60*1000; let t;
onAuthStateChanged(auth, async (u)=>{
  if(!u){ return window.location.href="index.html"; }
  const uDoc = await getDoc(doc(db,"usuarios", u.uid));
  if(!uDoc.exists() || uDoc.data().role!=="adm"){
    alert("Acesso permitido apenas ao Administrador.");
    await signOut(auth); return window.location.href="index.html";
  }
  init();
  reset();
  ["mousemove","keydown","click","scroll"].forEach(e=>document.addEventListener(e, reset));
});
function reset(){ clearTimeout(t); t=setTimeout(async()=>{ alert("‚è∞ Sess√£o expirada."); await signOut(auth); window.location.href="index.html"; }, LIMITE); }
window.logout = async()=>{ await signOut(auth); window.location.href="index.html"; };

/* Tabs */
window.setTab = (id, btn)=>{
  document.querySelectorAll(".tab-pane").forEach(p=>p.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll(".nav-tabs button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
};

/* Log helper */
async function logAction(acao, alvo, extra={}){
  try{
    await addDoc(collection(db,"logs"), {
      acao, alvo, feito_por_uid: auth.currentUser?.uid || null,
      feito_por_email: auth.currentUser?.email || null,
      data_hora: serverTimestamp(), ...extra
    });
  }catch(e){ console.warn("Falha ao gravar log:", e); }
}

/* Init */
function init(){ carregarUsuarios(); }

/* Usu√°rios */
function carregarUsuarios(){
  const tbody = document.getElementById("usuarios-body");
  onSnapshot(collection(db,"usuarios"), (snap)=>{
    tbody.innerHTML = "";
    snap.forEach(d=>{
      const u = d.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.nome||"-"}</td>
        <td>${u.email||"-"}</td>
        <td>${u.role||"-"}</td>
        <td>${u.aprovado?'<span class="badge-ok">Aprovado</span>':'<span class="badge-no">Pendente</span>'}</td>
        <td class="actions">
          <button class="aprovar" onclick="aprovar('${d.id}')">‚úî Aprovar</button>
          <button class="desaprovar" onclick="desaprovar('${d.id}')">‚úñ Desaprovar</button>
          <button class="editar" onclick="editarUsuario('${d.id}','${(u.nome||'').replace(/"/g,'&quot;')}','${u.role||''}')">‚úè Editar</button>
          <button class="reset" onclick="resetSenha('${u.email||''}')">üîÅ Resetar Senha</button>
          <button class="excluir" onclick="excluirUsuario('${d.id}')">üóë Excluir</button>
        </td>`;
      tbody.appendChild(tr);
    });
  });
}

/* Aprovar / Desaprovar */
window.aprovar = async(uid)=>{
  await updateDoc(doc(db,"usuarios",uid), {aprovado:true});
  await logAction("Aprovar usu√°rio", uid);
  alert("Usu√°rio aprovado!");
};

window.desaprovar = async(uid)=>{
  await updateDoc(doc(db,"usuarios",uid), {aprovado:false});
  await logAction("Desaprovar usu√°rio", uid);
  alert("Usu√°rio desaprovado!");
};

/* Outras fun√ß√µes existentes */
window.editarUsuario = async (uid, nomeAtual, cargoAtual)=>{
  const novoNome = prompt("Novo nome:", nomeAtual||"")?.trim();
  const novoCargo = prompt("Novo cargo (adm, chefe, ose, encarregado, aux_encarregado, motorista):", cargoAtual||"")?.trim();
  if(!novoNome || !novoCargo) return alert("Edi√ß√£o cancelada.");
  await updateDoc(doc(db,"usuarios",uid), { nome: novoNome, role: novoCargo });
  await logAction("Editar usu√°rio", uid, { nome: novoNome, role: novoCargo });
  alert("Usu√°rio atualizado.");
};

window.resetSenha = async (email)=>{
  if(!email) return alert("Usu√°rio sem e-mail.");
  try{ await sendPasswordResetEmail(auth, email); alert(`Email de redefini√ß√£o enviado para ${email}.`); await logAction("Reset senha", email); }
  catch(e){ alert("Erro ao enviar e-mail de redefini√ß√£o."); }
};

window.excluirUsuario = async (uid)=>{
  if(!confirm("Excluir usu√°rio?")) return;
  await deleteDoc(doc(db,"usuarios",uid));
  await logAction("Excluir usu√°rio", uid);
  alert("Usu√°rio exclu√≠do.");
};
</script>
</body>
</html>
